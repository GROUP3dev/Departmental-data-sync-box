-- phpMyAdmin SQL Dump
-- version 5.2.1
-- https://www.phpmyadmin.net/
--
-- Host: 127.0.0.1
-- Generation Time: Nov 28, 2025 at 11:36 AM
-- Server version: 10.4.32-MariaDB
-- PHP Version: 8.2.12

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Database: `dept_sync_db`
--

-- --------------------------------------------------------

--
-- Table structure for table `attachments`
--

CREATE TABLE `attachments` (
  `ATTACHMENT_ID` int(11) NOT NULL,
  `RECORD_ID` int(11) NOT NULL,
  `FILENAME` varchar(255) NOT NULL,
  `MIME_TYPE` varchar(100) DEFAULT NULL,
  `BLOB_DATA` longblob DEFAULT NULL,
  `UPLOADED_BY` int(11) NOT NULL,
  `UPLOADED_AT` timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `audit_log`
--

CREATE TABLE `audit_log` (
  `LOG_ID` bigint(20) NOT NULL,
  `LOG_TIMESTAMP` timestamp NOT NULL DEFAULT current_timestamp(),
  `USER_ID` int(11) DEFAULT NULL,
  `EVENT_TYPE` varchar(50) NOT NULL,
  `ENTITY_TYPE` varchar(50) DEFAULT NULL,
  `ENTITY_ID` varchar(36) DEFAULT NULL,
  `DETAILS` text DEFAULT NULL,
  `IP_ADDRESS` varchar(45) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `audit_log`
--

INSERT INTO `audit_log` (`LOG_ID`, `LOG_TIMESTAMP`, `USER_ID`, `EVENT_TYPE`, `ENTITY_TYPE`, `ENTITY_ID`, `DETAILS`, `IP_ADDRESS`) VALUES
(1, '2025-11-27 17:21:26', 1, 'LOGIN', NULL, NULL, 'User ebedi logged in.', NULL),
(2, '2025-11-27 17:22:06', 1, 'CREATE_USER', NULL, NULL, 'Created user: ebe (Role: 1)', NULL),
(3, '2025-11-27 17:22:48', 1, 'MANUAL_SYNC', NULL, NULL, 'Triggered LAN sync to 127.0.0.1', NULL),
(4, '2025-11-27 17:23:36', 3, 'LOGIN', NULL, NULL, 'User kalisa logged in.', NULL),
(5, '2025-11-27 17:24:13', 1, 'LOGIN', NULL, NULL, 'User ebedi logged in.', NULL),
(6, '2025-11-27 17:36:10', 1, 'LOGIN', NULL, NULL, 'User ebedi logged in.', NULL),
(7, '2025-11-27 17:36:42', 1, 'UPDATE_USER', NULL, NULL, 'Updated user: kalisa', NULL),
(8, '2025-11-27 17:37:35', 1, 'CREATE_USER', NULL, NULL, 'Created user: eee (Role: 1)', NULL),
(9, '2025-11-27 17:37:56', 1, 'UPDATE_USER', NULL, NULL, 'Updated user: eee', NULL),
(10, '2025-11-27 19:21:03', 1, 'LOGIN', NULL, NULL, 'User ebedi logged in.', NULL),
(11, '2025-11-27 19:28:42', 1, 'LOGIN', NULL, NULL, 'User ebedi logged in.', NULL),
(12, '2025-11-27 19:30:47', 3, 'LOGIN', NULL, NULL, 'User kalisa logged in.', NULL),
(13, '2025-11-27 19:31:59', 11, 'LOGIN', NULL, NULL, 'User emy logged in.', NULL),
(14, '2025-11-27 19:32:16', 11, 'CREATE_RECORD', NULL, NULL, 'Created record: 2222', NULL),
(15, '2025-11-27 19:33:01', 1, 'LOGIN', NULL, NULL, 'User ebedi logged in.', NULL),
(16, '2025-11-27 19:37:39', 13, 'LOGIN', NULL, NULL, 'User reka logged in.', NULL),
(17, '2025-11-27 19:37:45', 13, 'APPROVE_RECORD', NULL, NULL, 'Approved Record ID: 1', NULL);

-- --------------------------------------------------------

--
-- Table structure for table `departments`
--

CREATE TABLE `departments` (
  `DEPARTMENT_ID` int(11) NOT NULL,
  `SYNC_UUID` varchar(36) NOT NULL,
  `DEPARTMENT_NAME` varchar(100) NOT NULL,
  `HEAD_USER_ID` int(11) DEFAULT NULL,
  `LAST_MODIFIED_TS` bigint(20) NOT NULL,
  `SOURCE_ACTOR_ID` varchar(36) NOT NULL,
  `IS_DELETED` tinyint(1) NOT NULL DEFAULT 0,
  `CREATED_AT` timestamp NOT NULL DEFAULT current_timestamp(),
  `CODE` varchar(20) DEFAULT NULL,
  `NODE_IP` varchar(50) DEFAULT NULL,
  `UPDATED_AT` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  `ACTIVE_FLAG` tinyint(1) NOT NULL DEFAULT 1
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `departments`
--

INSERT INTO `departments` (`DEPARTMENT_ID`, `SYNC_UUID`, `DEPARTMENT_NAME`, `HEAD_USER_ID`, `LAST_MODIFIED_TS`, `SOURCE_ACTOR_ID`, `IS_DELETED`, `CREATED_AT`, `CODE`, `NODE_IP`, `UPDATED_AT`, `ACTIVE_FLAG`) VALUES
(1, '11111111-1111-4000-8000-000000000001', 'IT Department', NULL, 1732626450000, 'LOCAL_NODE_01', 0, '2025-11-27 14:06:08', NULL, NULL, '2025-11-27 19:27:55', 1),
(2, '22222222-2222-4000-8000-000000000002', 'Finance', NULL, 1732626450000, 'LOCAL_NODE_01', 0, '2025-11-27 14:06:08', NULL, NULL, '2025-11-27 19:27:55', 1);

-- --------------------------------------------------------

--
-- Table structure for table `marks`
--

CREATE TABLE `marks` (
  `MARK_ID` int(11) NOT NULL,
  `SYNC_UUID` varchar(36) NOT NULL,
  `RECORD_ID` int(11) NOT NULL,
  `COURSE_CODE` varchar(20) NOT NULL,
  `COURSE_NAME` varchar(100) NOT NULL,
  `GRADE` varchar(5) NOT NULL,
  `SCORE` decimal(5,2) DEFAULT NULL,
  `SEMESTER` varchar(20) DEFAULT NULL,
  `ISSUED_BY_USER_ID` int(11) NOT NULL,
  `LAST_MODIFIED_TS` bigint(20) NOT NULL,
  `SOURCE_ACTOR_ID` varchar(36) NOT NULL,
  `IS_DELETED` tinyint(1) NOT NULL DEFAULT 0,
  `CREATED_AT` timestamp NOT NULL DEFAULT current_timestamp(),
  `UPDATED_AT` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `records`
--

CREATE TABLE `records` (
  `RECORD_ID` int(11) NOT NULL,
  `SYNC_UUID` varchar(36) NOT NULL,
  `STUDENT_ID_NO` varchar(50) NOT NULL,
  `RECORD_TYPE` enum('STUDENT','STAFF') NOT NULL,
  `TITLE` varchar(255) NOT NULL,
  `DESCRIPTION` text DEFAULT NULL,
  `DEPARTMENT_ORIGIN_ID` int(11) NOT NULL,
  `STATUS` enum('DRAFT','PENDING','APPROVED','ARCHIVED') NOT NULL,
  `CREATED_BY` int(11) NOT NULL,
  `LAST_MODIFIED_TS` bigint(20) NOT NULL,
  `SOURCE_ACTOR_ID` varchar(36) NOT NULL,
  `IS_DELETED` tinyint(1) NOT NULL DEFAULT 0,
  `CREATED_AT` timestamp NOT NULL DEFAULT current_timestamp(),
  `UPDATED_AT` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `records`
--

INSERT INTO `records` (`RECORD_ID`, `SYNC_UUID`, `STUDENT_ID_NO`, `RECORD_TYPE`, `TITLE`, `DESCRIPTION`, `DEPARTMENT_ORIGIN_ID`, `STATUS`, `CREATED_BY`, `LAST_MODIFIED_TS`, `SOURCE_ACTOR_ID`, `IS_DELETED`, `CREATED_AT`, `UPDATED_AT`) VALUES
(1, 'bab2bdd4-96d7-4982-800f-429c73d1be69', '222222', 'STUDENT', '2222', '222222', 1, 'APPROVED', 11, 1764272265587, 'DESKTOP-2CU4D60', 0, '2025-11-27 19:32:16', '2025-11-27 19:37:45');

-- --------------------------------------------------------

--
-- Table structure for table `record_visibility`
--

CREATE TABLE `record_visibility` (
  `RECORD_ID` int(11) NOT NULL,
  `DEPARTMENT_ID` int(11) NOT NULL,
  `GRANTED_BY_USER_ID` int(11) NOT NULL,
  `GRANTED_AT` timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `roles`
--

CREATE TABLE `roles` (
  `ROLE_ID` int(11) NOT NULL,
  `ROLE_NAME` varchar(50) NOT NULL,
  `DESCRIPTION` varchar(255) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `roles`
--

INSERT INTO `roles` (`ROLE_ID`, `ROLE_NAME`, `DESCRIPTION`) VALUES
(1, 'ADMIN', 'System Administrator with full rights.'),
(2, 'DEPT_HEAD', 'Department Head, controls own department records and user access.'),
(3, 'REGISTRY', 'Registry Staff, responsible for data entry and student registration.'),
(4, 'STUDENT', 'View-only access to their own records.');

-- --------------------------------------------------------

--
-- Table structure for table `sync_logs`
--

CREATE TABLE `sync_logs` (
  `LOG_ID` bigint(20) NOT NULL,
  `SYNC_TIMESTAMP` timestamp NOT NULL DEFAULT current_timestamp(),
  `REMOTE_ACTOR_ID` varchar(36) NOT NULL,
  `DIRECTION` enum('INBOUND','OUTBOUND') NOT NULL,
  `STATUS` enum('SUCCESS','FAILURE','PARTIAL') NOT NULL,
  `ITEMS_PROCESSED` int(11) NOT NULL,
  `ITEMS_CONFLICTED` int(11) NOT NULL DEFAULT 0,
  `DETAILS` text DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `sync_queue`
--

CREATE TABLE `sync_queue` (
  `QUEUE_ID` bigint(20) NOT NULL,
  `SYNC_UUID` varchar(36) NOT NULL,
  `ENTITY_NAME` varchar(50) NOT NULL,
  `OPERATION_TYPE` enum('CREATE','UPDATE','DELETE') NOT NULL,
  `PAYLOAD_JSON` longtext NOT NULL,
  `LAST_MODIFIED_TS` bigint(20) NOT NULL,
  `SOURCE_ACTOR_ID` varchar(36) NOT NULL,
  `STATUS` enum('PENDING','PROCESSING','COMPLETED','FAILED') NOT NULL DEFAULT 'PENDING',
  `RETRY_COUNT` int(11) NOT NULL DEFAULT 0,
  `CREATED_AT` timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `sync_queue`
--

INSERT INTO `sync_queue` (`QUEUE_ID`, `SYNC_UUID`, `ENTITY_NAME`, `OPERATION_TYPE`, `PAYLOAD_JSON`, `LAST_MODIFIED_TS`, `SOURCE_ACTOR_ID`, `STATUS`, `RETRY_COUNT`, `CREATED_AT`) VALUES
(1, '01ca5d7f-b491-4659-9cc6-6409cf6891e1', 'User', 'CREATE', 'rO0ABXNyAAptb2RlbC5Vc2VyAAAAAAAAAAECAA1JAAxkZXBhcnRtZW50SWRaAAhpc0FjdGl2ZVoACWlzRGVsZXRlZEoADmxhc3RNb2RpZmllZFRzSQAGcm9sZUlkSQAGdXNlcklkTAAFZW1haWx0ABJMamF2YS9sYW5nL1N0cmluZztMAAlmaXJzdE5hbWVxAH4AAUwACGxhc3ROYW1lcQB+AAFMAAxwYXNzd29yZEhhc2hxAH4AAUwADXNvdXJjZUFjdG9ySWRxAH4AAUwACHN5bmNVVUlEcQB+AAFMAAh1c2VybmFtZXEAfgABeHAAAAABAQAAAAGaxjEDrwAAAAEAAAAAdAAVZWJlZGltZWxlY2tAZ21haWwuY29tdAAFaXR1emV0AAVlYmVkaXQAQDRlMWRkZGM5NDVlNWZiNDA2NmEyMTkxMTE1NzY3MTk1NGM4ZTExOTE2Y2U4ZTc4MTQxMGM3MWI1ODliZmYzMGF0AA9ERVNLVE9QLTJDVTRENjB0ACQwMWNhNWQ3Zi1iNDkxLTQ2NTktOWNjNi02NDA5Y2Y2ODkxZTF0AAVlYmVkaQ==', 1764261692335, 'DESKTOP-2CU4D60', 'COMPLETED', 1, '2025-11-27 16:41:33'),
(2, '7be73b2e-bdde-419c-ac88-a8d109be7a5e', 'User', 'CREATE', 'rO0ABXNyAAptb2RlbC5Vc2VyAAAAAAAAAAECAA1JAAxkZXBhcnRtZW50SWRaAAhpc0FjdGl2ZVoACWlzRGVsZXRlZEoADmxhc3RNb2RpZmllZFRzSQAGcm9sZUlkSQAGdXNlcklkTAAFZW1haWx0ABJMamF2YS9sYW5nL1N0cmluZztMAAlmaXJzdE5hbWVxAH4AAUwACGxhc3ROYW1lcQB+AAFMAAxwYXNzd29yZEhhc2hxAH4AAUwADXNvdXJjZUFjdG9ySWRxAH4AAUwACHN5bmNVVUlEcQB+AAFMAAh1c2VybmFtZXEAfgABeHAAAAABAQAAAAGaxjdiFgAAAAQAAAAAdAAQa2FsaXNhQGdtYWlsLmNvbXQABWthbGlzdAAFa2FtYW50AEA0ZTFkZGRjOTQ1ZTVmYjQwNjZhMjE5MTExNTc2NzE5NTRjOGUxMTkxNmNlOGU3ODE0MTBjNzFiNTg5YmZmMzBhdAAPREVTS1RPUC0yQ1U0RDYwdAAkN2JlNzNiMmUtYmRkZS00MTljLWFjODgtYThkMTA5YmU3YTVldAAGa2FsaXNh', 1764262109718, 'DESKTOP-2CU4D60', 'COMPLETED', 1, '2025-11-27 16:48:29'),
(3, '474b35f8-5398-4339-b702-c58247c7f8c1', 'User', 'CREATE', 'rO0ABXNyAAptb2RlbC5Vc2VyAAAAAAAAAAECAA1JAAxkZXBhcnRtZW50SWRaAAhpc0FjdGl2ZVoACWlzRGVsZXRlZEoADmxhc3RNb2RpZmllZFRzSQAGcm9sZUlkSQAGdXNlcklkTAAFZW1haWx0ABJMamF2YS9sYW5nL1N0cmluZztMAAlmaXJzdE5hbWVxAH4AAUwACGxhc3ROYW1lcQB+AAFMAAxwYXNzd29yZEhhc2hxAH4AAUwADXNvdXJjZUFjdG9ySWRxAH4AAUwACHN5bmNVVUlEcQB+AAFMAAh1c2VybmFtZXEAfgABeHAAAAABAQAAAAGaxj/avQAAAAMAAAAAdAAPaGVsbG9AZ21haWwuY29tdAAFaGVsbG90AAIyM3QAQDRlMWRkZGM5NDVlNWZiNDA2NmEyMTkxMTE1NzY3MTk1NGM4ZTExOTE2Y2U4ZTc4MTQxMGM3MWI1ODliZmYzMGF0AA9ERVNLVE9QLTJDVTRENjB0ACQ0NzRiMzVmOC01Mzk4LTQzMzktYjcwMi1jNTgyNDdjN2Y4YzF0AAVoZWxsbw==', 1764262664893, 'DESKTOP-2CU4D60', 'COMPLETED', 1, '2025-11-27 16:57:45'),
(4, '65d2cb52-a48d-4eb9-a437-0551c39ebb27', 'User', 'CREATE', 'rO0ABXNyAAptb2RlbC5Vc2VyAAAAAAAAAAECAA1JAAxkZXBhcnRtZW50SWRaAAhpc0FjdGl2ZVoACWlzRGVsZXRlZEoADmxhc3RNb2RpZmllZFRzSQAGcm9sZUlkSQAGdXNlcklkTAAFZW1haWx0ABJMamF2YS9sYW5nL1N0cmluZztMAAlmaXJzdE5hbWVxAH4AAUwACGxhc3ROYW1lcQB+AAFMAAxwYXNzd29yZEhhc2hxAH4AAUwADXNvdXJjZUFjdG9ySWRxAH4AAUwACHN5bmNVVUlEcQB+AAFMAAh1c2VybmFtZXEAfgABeHAAAAABAQAAAAGaxkKkFQAAAAMAAAAAcHQABWhlbGxvdAADaGhldABANGUxZGRkYzk0NWU1ZmI0MDY2YTIxOTExMTU3NjcxOTU0YzhlMTE5MTZjZThlNzgxNDEwYzcxYjU4OWJmZjMwYXQAD0RFU0tUT1AtMkNVNEQ2MHQAJDY1ZDJjYjUyLWE0OGQtNGViOS1hNDM3LTA1NTFjMzllYmIyN3QABWVub2Nr', 1764262847509, 'DESKTOP-2CU4D60', 'COMPLETED', 1, '2025-11-27 17:00:47'),
(5, '8a857338-fad1-452d-b30d-d9d7135f81c4', 'User', 'CREATE', 'rO0ABXNyAAptb2RlbC5Vc2VyAAAAAAAAAAECAA1JAAxkZXBhcnRtZW50SWRaAAhpc0FjdGl2ZVoACWlzRGVsZXRlZEoADmxhc3RNb2RpZmllZFRzSQAGcm9sZUlkSQAGdXNlcklkTAAFZW1haWx0ABJMamF2YS9sYW5nL1N0cmluZztMAAlmaXJzdE5hbWVxAH4AAUwACGxhc3ROYW1lcQB+AAFMAAxwYXNzd29yZEhhc2hxAH4AAUwADXNvdXJjZUFjdG9ySWRxAH4AAUwACHN5bmNVVUlEcQB+AAFMAAh1c2VybmFtZXEAfgABeHAAAAABAQAAAAGaxlM9SwAAAAIAAAAAcHQAAzIyMnQAAzIyMnQAQDRlMWRkZGM5NDVlNWZiNDA2NmEyMTkxMTE1NzY3MTk1NGM4ZTExOTE2Y2U4ZTc4MTQxMGM3MWI1ODliZmYzMGF0AA9ERVNLVE9QLTJDVTRENjB0ACQ4YTg1NzMzOC1mYWQxLTQ1MmQtYjMwZC1kOWQ3MTM1ZjgxYzR0AAdrYWxpc2Ey', 1764263935307, 'DESKTOP-2CU4D60', 'COMPLETED', 1, '2025-11-27 17:18:55'),
(6, '5e2df39f-e15a-4405-a16b-7715c67e3af4', 'User', 'CREATE', 'rO0ABXNyAAptb2RlbC5Vc2VyAAAAAAAAAAECAA1JAAxkZXBhcnRtZW50SWRaAAhpc0FjdGl2ZVoACWlzRGVsZXRlZEoADmxhc3RNb2RpZmllZFRzSQAGcm9sZUlkSQAGdXNlcklkTAAFZW1haWx0ABJMamF2YS9sYW5nL1N0cmluZztMAAlmaXJzdE5hbWVxAH4AAUwACGxhc3ROYW1lcQB+AAFMAAxwYXNzd29yZEhhc2hxAH4AAUwADXNvdXJjZUFjdG9ySWRxAH4AAUwACHN5bmNVVUlEcQB+AAFMAAh1c2VybmFtZXEAfgABeHAAAAABAQAAAAGaxlYoAgAAAAEAAAAAcHQAA2RkZHQAAnd3dABANGUxZGRkYzk0NWU1ZmI0MDY2YTIxOTExMTU3NjcxOTU0YzhlMTE5MTZjZThlNzgxNDEwYzcxYjU4OWJmZjMwYXQAD0RFU0tUT1AtMkNVNEQ2MHQAJDVlMmRmMzlmLWUxNWEtNDQwNS1hMTZiLTc3MTVjNjdlM2FmNHQAA2ViZQ==', 1764264126466, 'DESKTOP-2CU4D60', 'COMPLETED', 1, '2025-11-27 17:22:06'),
(7, '7be73b2e-bdde-419c-ac88-a8d109be7a5e', 'User', 'UPDATE', 'rO0ABXNyAAptb2RlbC5Vc2VyAAAAAAAAAAECAA1JAAxkZXBhcnRtZW50SWRaAAhpc0FjdGl2ZVoACWlzRGVsZXRlZEoADmxhc3RNb2RpZmllZFRzSQAGcm9sZUlkSQAGdXNlcklkTAAFZW1haWx0ABJMamF2YS9sYW5nL1N0cmluZztMAAlmaXJzdE5hbWVxAH4AAUwACGxhc3ROYW1lcQB+AAFMAAxwYXNzd29yZEhhc2hxAH4AAUwADXNvdXJjZUFjdG9ySWRxAH4AAUwACHN5bmNVVUlEcQB+AAFMAAh1c2VybmFtZXEAfgABeHAAAAABAQAAAAGaxmOGygAAAAQAAAADdAAQa2FsaXNhQGdtYWlsLmNvbXQABWthbGlzdAAFa2FtYW50AEA0ZTFkZGRjOTQ1ZTVmYjQwNjZhMjE5MTExNTc2NzE5NTRjOGUxMTkxNmNlOGU3ODE0MTBjNzFiNTg5YmZmMzBhdAAPREVTS1RPUC0yQ1U0RDYwdAAkN2JlNzNiMmUtYmRkZS00MTljLWFjODgtYThkMTA5YmU3YTVldAAGa2FsaXNh', 1764265002698, 'DESKTOP-2CU4D60', 'PENDING', 0, '2025-11-27 17:36:42'),
(8, '58fa2520-4a59-4a2d-bcb3-cb587eeeb1be', 'User', 'CREATE', 'rO0ABXNyAAptb2RlbC5Vc2VyAAAAAAAAAAECAA1JAAxkZXBhcnRtZW50SWRaAAhpc0FjdGl2ZVoACWlzRGVsZXRlZEoADmxhc3RNb2RpZmllZFRzSQAGcm9sZUlkSQAGdXNlcklkTAAFZW1haWx0ABJMamF2YS9sYW5nL1N0cmluZztMAAlmaXJzdE5hbWVxAH4AAUwACGxhc3ROYW1lcQB+AAFMAAxwYXNzd29yZEhhc2hxAH4AAUwADXNvdXJjZUFjdG9ySWRxAH4AAUwACHN5bmNVVUlEcQB+AAFMAAh1c2VybmFtZXEAfgABeHAAAAABAQAAAAGaxmRULAAAAAEAAAAAcHQAA2VlZXQAA2VlZXQAQGIwMDAzMjdlMDg1ZDUzMjg5ZDhiNWFmZmE0ZjYyYzMzZTk1MmUyMTY1ZTRlNjU3ODMwOGIzOWU5MDMwMjYxY2J0AA9ERVNLVE9QLTJDVTRENjB0ACQ1OGZhMjUyMC00YTU5LTRhMmQtYmNiMy1jYjU4N2VlZWIxYmV0AANlZWU=', 1764265055276, 'DESKTOP-2CU4D60', 'PENDING', 0, '2025-11-27 17:37:35'),
(9, '58fa2520-4a59-4a2d-bcb3-cb587eeeb1be', 'User', 'UPDATE', 'rO0ABXNyAAptb2RlbC5Vc2VyAAAAAAAAAAECAA1JAAxkZXBhcnRtZW50SWRaAAhpc0FjdGl2ZVoACWlzRGVsZXRlZEoADmxhc3RNb2RpZmllZFRzSQAGcm9sZUlkSQAGdXNlcklkTAAFZW1haWx0ABJMamF2YS9sYW5nL1N0cmluZztMAAlmaXJzdE5hbWVxAH4AAUwACGxhc3ROYW1lcQB+AAFMAAxwYXNzd29yZEhhc2hxAH4AAUwADXNvdXJjZUFjdG9ySWRxAH4AAUwACHN5bmNVVUlEcQB+AAFMAAh1c2VybmFtZXEAfgABeHAAAAABAAAAAAGaxmSniQAAAAEAAAAKcHQAA2VlZXQAA2VlZXQAQGIwMDAzMjdlMDg1ZDUzMjg5ZDhiNWFmZmE0ZjYyYzMzZTk1MmUyMTY1ZTRlNjU3ODMwOGIzOWU5MDMwMjYxY2J0AA9ERVNLVE9QLTJDVTRENjB0ACQ1OGZhMjUyMC00YTU5LTRhMmQtYmNiMy1jYjU4N2VlZWIxYmV0AANlZWU=', 1764265076617, 'DESKTOP-2CU4D60', 'PENDING', 0, '2025-11-27 17:37:56'),
(10, '2e6051a4-4952-4c00-b332-c9008c37642b', 'User', 'CREATE', 'rO0ABXNyAAptb2RlbC5Vc2VyAAAAAAAAAAECAA1JAAxkZXBhcnRtZW50SWRaAAhpc0FjdGl2ZVoACWlzRGVsZXRlZEoADmxhc3RNb2RpZmllZFRzSQAGcm9sZUlkSQAGdXNlcklkTAAFZW1haWx0ABJMamF2YS9sYW5nL1N0cmluZztMAAlmaXJzdE5hbWVxAH4AAUwACGxhc3ROYW1lcQB+AAFMAAxwYXNzd29yZEhhc2hxAH4AAUwADXNvdXJjZUFjdG9ySWRxAH4AAUwACHN5bmNVVUlEcQB+AAFMAAh1c2VybmFtZXEAfgABeHAAAAABAQAAAAGaxsza+AAAAAMAAAAAdAANZW15QGdtYWlsLmNvbXQAA2VteXQAA2VteXQAQDRlMWRkZGM5NDVlNWZiNDA2NmEyMTkxMTE1NzY3MTk1NGM4ZTExOTE2Y2U4ZTc4MTQxMGM3MWI1ODliZmYzMGF0AA9ERVNLVE9QLTJDVTRENjB0ACQyZTYwNTFhNC00OTUyLTRjMDAtYjMzMi1jOTAwOGMzNzY0MmJ0AANlbXk=', 1764271905528, 'DESKTOP-2CU4D60', 'PENDING', 0, '2025-11-27 19:31:46'),
(11, 'bab2bdd4-96d7-4982-800f-429c73d1be69', 'Record', 'CREATE', 'rO0ABXNyAAxtb2RlbC5SZWNvcmQAAAAAAAAAAQIADUkACWNyZWF0ZWRCeUkAEmRlcGFydG1lbnRPcmlnaW5JZFoACWlzRGVsZXRlZEoADmxhc3RNb2RpZmllZFRzSQAIcmVjb3JkSWRMAAljcmVhdGVkQXR0ABRMamF2YS9zcWwvVGltZXN0YW1wO0wAC2Rlc2NyaXB0aW9udAASTGphdmEvbGFuZy9TdHJpbmc7TAAKcmVjb3JkVHlwZXEAfgACTAANc291cmNlQWN0b3JJZHEAfgACTAAGc3RhdHVzcQB+AAJMAAtzdHVkZW50SWROb3EAfgACTAAIc3luY1VVSURxAH4AAkwABXRpdGxlcQB+AAJ4cAAAAAsAAAABAAAAAZrGzVJrAAAAAHB0AAYyMjIyMjJ0AAdTVFVERU5UdAAPREVTS1RPUC0yQ1U0RDYwdAAHUEVORElOR3QABjIyMjIyMnQAJGJhYjJiZGQ0LTk2ZDctNDk4Mi04MDBmLTQyOWM3M2QxYmU2OXQABDIyMjI=', 1764271936107, 'DESKTOP-2CU4D60', 'PENDING', 0, '2025-11-27 19:32:16'),
(12, 'e0d56935-7cbc-4e7c-a300-3b6c57f9ae8e', 'User', 'CREATE', 'rO0ABXNyAAptb2RlbC5Vc2VyAAAAAAAAAAECAA1JAAxkZXBhcnRtZW50SWRaAAhpc0FjdGl2ZVoACWlzRGVsZXRlZEoADmxhc3RNb2RpZmllZFRzSQAGcm9sZUlkSQAGdXNlcklkTAAFZW1haWx0ABJMamF2YS9sYW5nL1N0cmluZztMAAlmaXJzdE5hbWVxAH4AAUwACGxhc3ROYW1lcQB+AAFMAAxwYXNzd29yZEhhc2hxAH4AAUwADXNvdXJjZUFjdG9ySWRxAH4AAUwACHN5bmNVVUlEcQB+AAFMAAh1c2VybmFtZXEAfgABeHAAAAABAQAAAAGaxtEDRAAAAAIAAAAAdAAOZGVwdEBnbWFpbC5jb210AARkZXB0dAAEZGVwdHQAQGIwMDAzMjdlMDg1ZDUzMjg5ZDhiNWFmZmE0ZjYyYzMzZTk1MmUyMTY1ZTRlNjU3ODMwOGIzOWU5MDMwMjYxY2J0AA9ERVNLVE9QLTJDVTRENjB0ACRlMGQ1NjkzNS03Y2JjLTRlN2MtYTMwMC0zYjZjNTdmOWFlOGV0AARkZXB0', 1764272177988, 'DESKTOP-2CU4D60', 'PENDING', 0, '2025-11-27 19:36:18'),
(13, '304ae39b-e99a-44ec-a245-72dc055b0872', 'User', 'CREATE', 'rO0ABXNyAAptb2RlbC5Vc2VyAAAAAAAAAAECAA1JAAxkZXBhcnRtZW50SWRaAAhpc0FjdGl2ZVoACWlzRGVsZXRlZEoADmxhc3RNb2RpZmllZFRzSQAGcm9sZUlkSQAGdXNlcklkTAAFZW1haWx0ABJMamF2YS9sYW5nL1N0cmluZztMAAlmaXJzdE5hbWVxAH4AAUwACGxhc3ROYW1lcQB+AAFMAAxwYXNzd29yZEhhc2hxAH4AAUwADXNvdXJjZUFjdG9ySWRxAH4AAUwACHN5bmNVVUlEcQB+AAFMAAh1c2VybmFtZXEAfgABeHAAAAABAQAAAAGaxtIXFAAAAAIAAAAAdAAOcmVrYUBnbWFpbC5jb210AARyZWthdAAEcmVrYXQAQDRlMWRkZGM5NDVlNWZiNDA2NmEyMTkxMTE1NzY3MTk1NGM4ZTExOTE2Y2U4ZTc4MTQxMGM3MWI1ODliZmYzMGF0AA9ERVNLVE9QLTJDVTRENjB0ACQzMDRhZTM5Yi1lOTlhLTQ0ZWMtYTI0NS03MmRjMDU1YjA4NzJ0AARyZWth', 1764272248596, 'DESKTOP-2CU4D60', 'PENDING', 0, '2025-11-27 19:37:28'),
(14, 'bab2bdd4-96d7-4982-800f-429c73d1be69', 'Record', 'UPDATE', 'rO0ABXNyAAxtb2RlbC5SZWNvcmQAAAAAAAAAAQIADUkACWNyZWF0ZWRCeUkAEmRlcGFydG1lbnRPcmlnaW5JZFoACWlzRGVsZXRlZEoADmxhc3RNb2RpZmllZFRzSQAIcmVjb3JkSWRMAAljcmVhdGVkQXR0ABRMamF2YS9zcWwvVGltZXN0YW1wO0wAC2Rlc2NyaXB0aW9udAASTGphdmEvbGFuZy9TdHJpbmc7TAAKcmVjb3JkVHlwZXEAfgACTAANc291cmNlQWN0b3JJZHEAfgACTAAGc3RhdHVzcQB+AAJMAAtzdHVkZW50SWROb3EAfgACTAAIc3luY1VVSURxAH4AAkwABXRpdGxlcQB+AAJ4cAAAAAsAAAABAAAAAZrG0llzAAAAAXNyABJqYXZhLnNxbC5UaW1lc3RhbXAmGNXIAVO/ZQIAAUkABW5hbm9zeHIADmphdmEudXRpbC5EYXRlaGqBAUtZdBkDAAB4cHcIAAABmsc7LwB4AAAAAHQABjIyMjIyMnQAB1NUVURFTlR0AA9ERVNLVE9QLTJDVTRENjB0AAhBUFBST1ZFRHQABjIyMjIyMnQAJGJhYjJiZGQ0LTk2ZDctNDk4Mi04MDBmLTQyOWM3M2QxYmU2OXQABDIyMjI=', 1764272265587, 'DESKTOP-2CU4D60', 'PENDING', 0, '2025-11-27 19:37:45');

-- --------------------------------------------------------

--
-- Table structure for table `users`
--

CREATE TABLE `users` (
  `USER_ID` int(11) NOT NULL,
  `SYNC_UUID` varchar(36) NOT NULL,
  `USERNAME` varchar(50) NOT NULL,
  `PASSWORD_HASH` varchar(255) NOT NULL,
  `ROLE_ID` int(11) NOT NULL,
  `DEPARTMENT_ID` int(11) NOT NULL,
  `FIRST_NAME` varchar(100) DEFAULT NULL,
  `LAST_NAME` varchar(100) DEFAULT NULL,
  `EMAIL` varchar(100) DEFAULT NULL,
  `IS_ACTIVE` tinyint(1) NOT NULL DEFAULT 1,
  `LAST_MODIFIED_TS` bigint(20) NOT NULL,
  `SOURCE_ACTOR_ID` varchar(36) NOT NULL,
  `IS_DELETED` tinyint(1) NOT NULL DEFAULT 0,
  `CREATED_AT` timestamp NOT NULL DEFAULT current_timestamp(),
  `UPDATED_AT` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `users`
--

INSERT INTO `users` (`USER_ID`, `SYNC_UUID`, `USERNAME`, `PASSWORD_HASH`, `ROLE_ID`, `DEPARTMENT_ID`, `FIRST_NAME`, `LAST_NAME`, `EMAIL`, `IS_ACTIVE`, `LAST_MODIFIED_TS`, `SOURCE_ACTOR_ID`, `IS_DELETED`, `CREATED_AT`, `UPDATED_AT`) VALUES
(1, '01ca5d7f-b491-4659-9cc6-6409cf6891e1', 'ebedi', '4e1dddc945e5fb4066a21911157671954c8e11916ce8e781410c71b589bff30a', 1, 1, 'ituze', 'ebedi', 'ebedimeleck@gmail.com', 1, 1764261692335, 'DESKTOP-2CU4D60', 0, '2025-11-27 16:41:33', '2025-11-27 16:41:33'),
(3, '7be73b2e-bdde-419c-ac88-a8d109be7a5e', 'kalisa', '4e1dddc945e5fb4066a21911157671954c8e11916ce8e781410c71b589bff30a', 4, 1, 'kalis', 'kaman', 'kalisa@gmail.com', 1, 1764265002698, 'DESKTOP-2CU4D60', 0, '2025-11-27 16:48:29', '2025-11-27 17:36:42'),
(5, '474b35f8-5398-4339-b702-c58247c7f8c1', 'hello', '4e1dddc945e5fb4066a21911157671954c8e11916ce8e781410c71b589bff30a', 3, 1, 'hello', '23', 'hello@gmail.com', 1, 1764262664893, 'DESKTOP-2CU4D60', 0, '2025-11-27 16:57:44', '2025-11-27 16:57:44'),
(6, '65d2cb52-a48d-4eb9-a437-0551c39ebb27', 'enock', '4e1dddc945e5fb4066a21911157671954c8e11916ce8e781410c71b589bff30a', 3, 1, 'hello', 'hhe', NULL, 1, 1764262847509, 'DESKTOP-2CU4D60', 0, '2025-11-27 17:00:47', '2025-11-27 17:00:47'),
(8, '8a857338-fad1-452d-b30d-d9d7135f81c4', 'kalisa2', '4e1dddc945e5fb4066a21911157671954c8e11916ce8e781410c71b589bff30a', 2, 1, '222', '222', NULL, 1, 1764263935307, 'DESKTOP-2CU4D60', 0, '2025-11-27 17:18:55', '2025-11-27 17:18:55'),
(9, '5e2df39f-e15a-4405-a16b-7715c67e3af4', 'ebe', '4e1dddc945e5fb4066a21911157671954c8e11916ce8e781410c71b589bff30a', 1, 1, 'ddd', 'ww', NULL, 1, 1764264126466, 'DESKTOP-2CU4D60', 0, '2025-11-27 17:22:06', '2025-11-27 17:22:06'),
(10, '58fa2520-4a59-4a2d-bcb3-cb587eeeb1be', 'eee', 'b000327e085d53289d8b5affa4f62c33e952e2165e4e6578308b39e9030261cb', 1, 1, 'eee', 'eee', NULL, 0, 1764265076617, 'DESKTOP-2CU4D60', 0, '2025-11-27 17:37:35', '2025-11-27 17:37:56'),
(11, '2e6051a4-4952-4c00-b332-c9008c37642b', 'emy', '4e1dddc945e5fb4066a21911157671954c8e11916ce8e781410c71b589bff30a', 3, 1, 'emy', 'emy', 'emy@gmail.com', 1, 1764271905528, 'DESKTOP-2CU4D60', 0, '2025-11-27 19:31:45', '2025-11-27 19:31:45'),
(12, 'e0d56935-7cbc-4e7c-a300-3b6c57f9ae8e', 'dept', 'b000327e085d53289d8b5affa4f62c33e952e2165e4e6578308b39e9030261cb', 2, 1, 'dept', 'dept', 'dept@gmail.com', 1, 1764272177988, 'DESKTOP-2CU4D60', 0, '2025-11-27 19:36:17', '2025-11-27 19:36:17'),
(13, '304ae39b-e99a-44ec-a245-72dc055b0872', 'reka', '4e1dddc945e5fb4066a21911157671954c8e11916ce8e781410c71b589bff30a', 2, 1, 'reka', 'reka', 'reka@gmail.com', 1, 1764272248596, 'DESKTOP-2CU4D60', 0, '2025-11-27 19:37:28', '2025-11-27 19:37:28');

--
-- Indexes for dumped tables
--

--
-- Indexes for table `attachments`
--
ALTER TABLE `attachments`
  ADD PRIMARY KEY (`ATTACHMENT_ID`),
  ADD KEY `FK_ATTACH_RECORD` (`RECORD_ID`),
  ADD KEY `FK_ATTACH_UPLOADER` (`UPLOADED_BY`);

--
-- Indexes for table `audit_log`
--
ALTER TABLE `audit_log`
  ADD PRIMARY KEY (`LOG_ID`),
  ADD KEY `FK_AUDIT_USER` (`USER_ID`);

--
-- Indexes for table `departments`
--
ALTER TABLE `departments`
  ADD PRIMARY KEY (`DEPARTMENT_ID`),
  ADD UNIQUE KEY `UQ_UUID` (`SYNC_UUID`),
  ADD UNIQUE KEY `UQ_NAME` (`DEPARTMENT_NAME`),
  ADD KEY `FK_DEPT_HEAD` (`HEAD_USER_ID`);

--
-- Indexes for table `marks`
--
ALTER TABLE `marks`
  ADD PRIMARY KEY (`MARK_ID`),
  ADD UNIQUE KEY `UQ_SYNC_UUID` (`SYNC_UUID`),
  ADD UNIQUE KEY `UQ_RECORD_COURSE` (`RECORD_ID`,`COURSE_CODE`),
  ADD KEY `FK_MARK_ISSUED_BY` (`ISSUED_BY_USER_ID`);

--
-- Indexes for table `records`
--
ALTER TABLE `records`
  ADD PRIMARY KEY (`RECORD_ID`),
  ADD UNIQUE KEY `UQ_SYNC_UUID` (`SYNC_UUID`),
  ADD UNIQUE KEY `UQ_STUDENT_ID` (`STUDENT_ID_NO`),
  ADD KEY `FK_RECORD_DEPT` (`DEPARTMENT_ORIGIN_ID`),
  ADD KEY `FK_RECORD_CREATOR` (`CREATED_BY`);

--
-- Indexes for table `record_visibility`
--
ALTER TABLE `record_visibility`
  ADD PRIMARY KEY (`RECORD_ID`,`DEPARTMENT_ID`),
  ADD KEY `FK_RV_DEPT` (`DEPARTMENT_ID`),
  ADD KEY `FK_RV_GRANTED_BY` (`GRANTED_BY_USER_ID`);

--
-- Indexes for table `roles`
--
ALTER TABLE `roles`
  ADD PRIMARY KEY (`ROLE_ID`);

--
-- Indexes for table `sync_logs`
--
ALTER TABLE `sync_logs`
  ADD PRIMARY KEY (`LOG_ID`);

--
-- Indexes for table `sync_queue`
--
ALTER TABLE `sync_queue`
  ADD PRIMARY KEY (`QUEUE_ID`);

--
-- Indexes for table `users`
--
ALTER TABLE `users`
  ADD PRIMARY KEY (`USER_ID`),
  ADD UNIQUE KEY `UQ_USERNAME` (`USERNAME`),
  ADD UNIQUE KEY `UQ_EMAIL` (`EMAIL`),
  ADD KEY `FK_USER_ROLE` (`ROLE_ID`),
  ADD KEY `FK_USER_DEPT` (`DEPARTMENT_ID`);

--
-- AUTO_INCREMENT for dumped tables
--

--
-- AUTO_INCREMENT for table `attachments`
--
ALTER TABLE `attachments`
  MODIFY `ATTACHMENT_ID` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `audit_log`
--
ALTER TABLE `audit_log`
  MODIFY `LOG_ID` bigint(20) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=18;

--
-- AUTO_INCREMENT for table `departments`
--
ALTER TABLE `departments`
  MODIFY `DEPARTMENT_ID` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=3;

--
-- AUTO_INCREMENT for table `marks`
--
ALTER TABLE `marks`
  MODIFY `MARK_ID` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `records`
--
ALTER TABLE `records`
  MODIFY `RECORD_ID` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=2;

--
-- AUTO_INCREMENT for table `roles`
--
ALTER TABLE `roles`
  MODIFY `ROLE_ID` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=5;

--
-- AUTO_INCREMENT for table `sync_logs`
--
ALTER TABLE `sync_logs`
  MODIFY `LOG_ID` bigint(20) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `sync_queue`
--
ALTER TABLE `sync_queue`
  MODIFY `QUEUE_ID` bigint(20) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=15;

--
-- AUTO_INCREMENT for table `users`
--
ALTER TABLE `users`
  MODIFY `USER_ID` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=14;

--
-- Constraints for dumped tables
--

--
-- Constraints for table `attachments`
--
ALTER TABLE `attachments`
  ADD CONSTRAINT `FK_ATTACH_RECORD` FOREIGN KEY (`RECORD_ID`) REFERENCES `records` (`RECORD_ID`) ON DELETE CASCADE,
  ADD CONSTRAINT `FK_ATTACH_UPLOADER` FOREIGN KEY (`UPLOADED_BY`) REFERENCES `users` (`USER_ID`);

--
-- Constraints for table `audit_log`
--
ALTER TABLE `audit_log`
  ADD CONSTRAINT `FK_AUDIT_USER` FOREIGN KEY (`USER_ID`) REFERENCES `users` (`USER_ID`) ON DELETE SET NULL;

--
-- Constraints for table `departments`
--
ALTER TABLE `departments`
  ADD CONSTRAINT `FK_DEPT_HEAD` FOREIGN KEY (`HEAD_USER_ID`) REFERENCES `users` (`USER_ID`) ON DELETE SET NULL;

--
-- Constraints for table `marks`
--
ALTER TABLE `marks`
  ADD CONSTRAINT `FK_MARK_ISSUED_BY` FOREIGN KEY (`ISSUED_BY_USER_ID`) REFERENCES `users` (`USER_ID`),
  ADD CONSTRAINT `FK_MARK_RECORD` FOREIGN KEY (`RECORD_ID`) REFERENCES `records` (`RECORD_ID`) ON DELETE CASCADE;

--
-- Constraints for table `records`
--
ALTER TABLE `records`
  ADD CONSTRAINT `FK_RECORD_CREATOR` FOREIGN KEY (`CREATED_BY`) REFERENCES `users` (`USER_ID`),
  ADD CONSTRAINT `FK_RECORD_DEPT` FOREIGN KEY (`DEPARTMENT_ORIGIN_ID`) REFERENCES `departments` (`DEPARTMENT_ID`);

--
-- Constraints for table `record_visibility`
--
ALTER TABLE `record_visibility`
  ADD CONSTRAINT `FK_RV_DEPT` FOREIGN KEY (`DEPARTMENT_ID`) REFERENCES `departments` (`DEPARTMENT_ID`),
  ADD CONSTRAINT `FK_RV_GRANTED_BY` FOREIGN KEY (`GRANTED_BY_USER_ID`) REFERENCES `users` (`USER_ID`),
  ADD CONSTRAINT `FK_RV_RECORD` FOREIGN KEY (`RECORD_ID`) REFERENCES `records` (`RECORD_ID`) ON DELETE CASCADE;

--
-- Constraints for table `users`
--
ALTER TABLE `users`
  ADD CONSTRAINT `FK_USER_DEPT` FOREIGN KEY (`DEPARTMENT_ID`) REFERENCES `departments` (`DEPARTMENT_ID`),
  ADD CONSTRAINT `FK_USER_ROLE` FOREIGN KEY (`ROLE_ID`) REFERENCES `roles` (`ROLE_ID`);
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
